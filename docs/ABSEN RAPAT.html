<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Halaman Absensi Rapat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
    @media (max-width: 640px) {
      main {
        font-size: 0.8rem;
      }
      main h1 {
        font-size: 2.4rem;
      }
      form > div,
      form > div > label,
      form > div > h2 {
        margin-bottom: 0.64rem;
      }
      select,
      input[type="text"],
      textarea,
      button,
      input[type="file"],
      input[type="date"],
      input[type="time"] {
        padding: 0.64rem;
        font-size: 0.8rem;
      }
      button {
        padding-left: 1.92rem;
        padding-right: 1.92rem;
        padding-top: 2.4rem;
        padding-bottom: 2.4rem;
      }
      table th,
      table td {
        padding: 0.64rem 0.96rem;
        font-size: 0.8rem;
      }
      #fotoDokumentasiInfo,
      #fotoDokumentasiError {
        font-size: 0.64rem;
      }
      .flex-col-sm {
        flex-direction: column !important;
      }
      .w-full-sm {
        width: 100% !important;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center p-4">
  <main class="w-full max-w-5xl bg-white rounded-lg shadow-md p-6 mb-10">
    <h1 class="text-3xl font-semibold mb-6 text-center text-gray-800">
      Absensi Rapat
    </h1>
    <form id="absensiForm" class="space-y-8" novalidate>
      <div class="flex flex-wrap gap-6">
        <div class="flex-1 min-w-[250px]">
          <label for="agendaRapat" class="block mb-2 font-medium text-gray-700">Pilih Agenda Rapat</label>
          <select id="agendaRapat" name="agendaRapat" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="" disabled selected>-- Pilih Agenda Rapat --</option>
            <option value="rapat1">Rapat Koordinasi Kurikulum</option>
            <option value="rapat2">Rapat Evaluasi Semester</option>
            <option value="rapat3">Rapat Persiapan Ujian</option>
            <option value="rapat4">Rapat Pengembangan SDM</option>
            <option value="rapat5">Rapat Kegiatan Ekstrakurikuler</option>
          </select>
        </div>
        <div class="flex-1 min-w-[250px]">
          <label for="pimpinanRapat" class="block mb-2 font-medium text-gray-700">Pimpinan Rapat</label>
          <input type="text" id="pimpinanRapat" name="pimpinanRapat" readonly placeholder="Otomatis terisi" aria-readonly="true" class="w-full border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed" />
        </div>
        <div class="flex-1 min-w-[250px]">
          <label for="sekretarisRapat" class="block mb-2 font-medium text-gray-700">Sekretaris Rapat</label>
          <input type="text" id="sekretarisRapat" name="sekretarisRapat" readonly placeholder="Otomatis terisi" aria-readonly="true" class="w-full border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed" />
        </div>
      </div>
      <div class="flex flex-wrap gap-6">
        <div class="flex-1 min-w-[150px]">
          <label for="tanggalRapat" class="block mb-2 font-medium text-gray-700">Tanggal Rapat</label>
          <input type="date" id="tanggalRapat" name="tanggalRapat" readonly aria-readonly="true" class="w-full border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed" />
        </div>
        <div class="flex-1 min-w-[150px]">
          <label for="waktuRapat" class="block mb-2 font-medium text-gray-700">Waktu Rapat</label>
          <input type="time" id="waktuRapat" name="waktuRapat" readonly aria-readonly="true" class="w-full border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed" />
        </div>
        <div class="flex-1 min-w-[250px]">
          <label for="tempatRapat" class="block mb-2 font-medium text-gray-700">Tempat Rapat</label>
          <input type="text" id="tempatRapat" name="tempatRapat" readonly placeholder="Otomatis terisi" aria-readonly="true" class="w-full border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed" />
        </div>
      </div>

      <div>
        <h2 class="text-xl font-semibold mb-4 text-gray-800">Daftar Hadir Rapat</h2>
        <div class="overflow-x-auto border border-gray-300 rounded-md">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Nama</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Jabatan Instansi</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Jabatan Rapat</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Nomor HP</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Status Kehadiran</th>
                <th class="px-3 py-2 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">Aksi</th>
              </tr>
            </thead>
            <tbody id="daftarHadirBody" class="bg-white divide-y divide-gray-200">
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Andi Prasetyo" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Manager Kurikulum" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6281234567890" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Sari Wulandari" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Sekretaris" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6289876543210" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Rizky Maulana" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Koordinator" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6281122334455" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Dewi Anggraini" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Staff Administrasi" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6285566778899" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Fajar Nugroho" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Pengembang SDM" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6283344556677" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Lina Marlina" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Koordinator Ekstrakurikuler" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6287788990011" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Hendra Saputra" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Manajer SDM" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6282233445566" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Joko Prasetyo" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Sekretaris Ujian" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6286677889900" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Maya Sari" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Pengembang SDM" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat">Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan" selected>Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6284455667788" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="Agus Wijaya" required /></td>
                <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="Kepala Sekolah" required /></td>
                <td class="px-3 py-2">
                  <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Pimpinan Rapat" selected>Pimpinan Rapat</option>
                    <option value="Sekretaris Rapat">Sekretaris Rapat</option>
                    <option value="Guru">Guru</option>
                    <option value="Tamu Undangan">Tamu Undangan</option>
                    <option value="Yayasan">Yayasan</option>
                    <option value="Pengawas">Pengawas</option>
                  </select>
                </td>
                <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\+?\d{7,15}$" title="Masukkan nomor HP yang valid" value="+6289988776655" required /></td>
                <td class="px-3 py-2">
                  <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
                    <option value="Hadir" selected>Hadir</option>
                    <option value="Izin">Izin</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Alpha">Alpha</option>
                  </select>
                </td>
                <td class="px-3 py-2 text-center">
                  <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mt-3 text-right">
          <button type="button" id="addRowBtn" class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-md focus:outline-none focus:ring-4 focus:ring-green-300">
            <i class="fas fa-plus-circle"></i> Tambah Baris
          </button>
        </div>
      </div>

      <div>
        <label for="fotoDokumentasi" class="block mb-2 font-medium text-gray-700">Dokumentasi Foto (minimal 2 foto)</label>
        <input type="file" accept="image/*" id="fotoDokumentasi" name="fotoDokumentasi" multiple required class="block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
        <p id="fotoDokumentasiInfo" class="text-sm text-gray-500 mt-2">
          Unggah minimal 2 foto. Foto akan otomatis dikompres agar ukuran antara 100-300kb.
        </p>
        <p id="fotoDokumentasiError" class="text-xs text-red-600 mt-1 hidden">Harap unggah minimal 2 foto.</p>
      </div>
      <div>
        <label for="hasilRapat" class="block mb-2 font-medium text-gray-700">Hasil Rapat</label>
        <textarea id="hasilRapat" name="hasilRapat" rows="5" placeholder="Tuliskan hasil rapat di sini..." class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y" required></textarea>
      </div>
      <div>
        <label for="beritaAcara" class="block mb-2 font-medium text-gray-700">Berita Acara</label>
        <textarea id="beritaAcara" name="beritaAcara" rows="5" placeholder="Tuliskan berita acara rapat di sini..." class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y" required></textarea>
      </div>
      <div class="text-center">
        <button type="submit" class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-md focus:outline-none focus:ring-4 focus:ring-blue-300">
          <i class="fas fa-check-circle"></i> Kirim Absensi Rapat
        </button>
      </div>
    </form>
  </main>
  <script>
    const agendaRapat = document.getElementById("agendaRapat");
    const pimpinanRapat = document.getElementById("pimpinanRapat");
    const sekretarisRapat = document.getElementById("sekretarisRapat");
    const tanggalRapat = document.getElementById("tanggalRapat");
    const waktuRapat = document.getElementById("waktuRapat");
    const tempatRapat = document.getElementById("tempatRapat");
    const daftarHadirBody = document.getElementById("daftarHadirBody");
    const fotoDokumentasi = document.getElementById("fotoDokumentasi");
    const fotoDokumentasiError = document.getElementById("fotoDokumentasiError");

    const agendaData = {
      rapat1: { pimpinan: "Budi Santoso", sekretaris: "Siti Aminah", tanggal: "2024-07-01", waktu: "09:00", tempat: "Ruang Rapat Utama" },
      rapat2: { pimpinan: "Agus Wijaya", sekretaris: "Dewi Lestari", tanggal: "2024-07-05", waktu: "13:30", tempat: "Ruang Rapat 2" },
      rapat3: { pimpinan: "Rina Marlina", sekretaris: "Joko Prasetyo", tanggal: "2024-07-10", waktu: "08:00", tempat: "Ruang Rapat Utama" },
      rapat4: { pimpinan: "Maya Sari", sekretaris: "Hendra Saputra", tanggal: "2024-07-15", waktu: "14:00", tempat: "Ruang Rapat 3" },
      rapat5: { pimpinan: "Lina Marlina", sekretaris: "Fajar Nugroho", tanggal: "2024-07-20", waktu: "10:00", tempat: "Ruang Rapat Utama" },
    };

    agendaRapat.addEventListener("change", () => {
      const data = agendaData[agendaRapat.value] || {};
      pimpinanRapat.value = data.pimpinan || "";
      sekretarisRapat.value = data.sekretaris || "";
      tanggalRapat.value = data.tanggal || "";
      waktuRapat.value = data.waktu || "";
      tempatRapat.value = data.tempat || "";
    });

    async function compressImage(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (e) => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement("canvas");
            const maxDim = 1024;
            let { width, height } = img;
            if (width > height) {
              if (width > maxDim) {
                height *= maxDim / width;
                width = maxDim;
              }
            } else {
              if (height > maxDim) {
                width *= maxDim / height;
                height = maxDim;
              }
            }
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, width, height);
            ctx.drawImage(img, 0, 0, width, height);
            let quality = 0.9;
            function tryCompress() {
              canvas.toBlob(blob => {
                if (!blob) return reject(new Error("Compression failed"));
                if (blob.size >= 100 * 1024 && blob.size <= 300 * 1024) resolve(blob);
                else if (quality > 0.4) {
                  quality -= 0.1;
                  tryCompress();
                } else resolve(blob);
              }, "image/jpeg", quality);
            }
            tryCompress();
          };
          img.onerror = () => reject(new Error("Invalid image"));
        };
        reader.onerror = () => reject(new Error("File reading error"));
      });
    }

    async function validateAndCompressPhotos() {
      fotoDokumentasiError.classList.add("hidden");
      if (!fotoDokumentasi.files || fotoDokumentasi.files.length < 2) {
        fotoDokumentasiError.textContent = "Harap unggah minimal 2 foto.";
        fotoDokumentasiError.classList.remove("hidden");
        return null;
      }
      try {
        const compressedPhotos = [];
        for (const file of fotoDokumentasi.files) {
          compressedPhotos.push(await compressImage(file));
        }
        return compressedPhotos;
      } catch (error) {
        alert("Terjadi kesalahan saat memproses foto: " + error.message);
        return null;
      }
    }

    function removeRow(button) {
      if (daftarHadirBody.rows.length > 1) {
        button.closest("tr").remove();
      } else {
        alert("Minimal harus ada satu baris daftar hadir.");
      }
    }

    function createRow(data = {}) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="px-3 py-2"><input type="text" name="nama[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nama" value="${data.nama || ""}" required /></td>
        <td class="px-3 py-2"><input type="text" name="jabatanInstansi[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Jabatan Instansi" value="${data.jabatanInstansi || ""}" required /></td>
        <td class="px-3 py-2">
          <select name="jabatanRapat[]" class="w-full border border-gray-300 rounded-md p-1" required>
            <option value="Pimpinan Rapat" ${data.jabatanRapat === "Pimpinan Rapat" ? "selected" : ""}>Pimpinan Rapat</option>
            <option value="Sekretaris Rapat" ${data.jabatanRapat === "Sekretaris Rapat" ? "selected" : ""}>Sekretaris Rapat</option>
            <option value="Guru" ${data.jabatanRapat === "Guru" ? "selected" : ""}>Guru</option>
            <option value="Tamu Undangan" ${!data.jabatanRapat || data.jabatanRapat === "Tamu Undangan" ? "selected" : ""}>Tamu Undangan</option>
            <option value="Yayasan" ${data.jabatanRapat === "Yayasan" ? "selected" : ""}>Yayasan</option>
            <option value="Pengawas" ${data.jabatanRapat === "Pengawas" ? "selected" : ""}>Pengawas</option>
          </select>
        </td>
        <td class="px-3 py-2"><input type="text" name="nomorHp[]" class="w-full border border-gray-300 rounded-md p-1" placeholder="Nomor HP" pattern="^\\+?\\d{7,15}$" title="Masukkan nomor HP yang valid" value="${data.nomorHp || ""}" required /></td>
        <td class="px-3 py-2">
          <select name="statusKehadiran[]" class="w-full border border-gray-300 rounded-md p-1" required>
            <option value="Hadir" ${data.statusKehadiran === "Hadir" ? "selected" : ""}>Hadir</option>
            <option value="Izin" ${data.statusKehadiran === "Izin" ? "selected" : ""}>Izin</option>
            <option value="Sakit" ${data.statusKehadiran === "Sakit" ? "selected" : ""}>Sakit</option>
            <option value="Alpha" ${data.statusKehadiran === "Alpha" ? "selected" : ""}>Alpha</option>
          </select>
        </td>
        <td class="px-3 py-2 text-center">
          <button type="button" class="text-red-600 hover:text-red-800 focus:outline-none" aria-label="Hapus baris" onclick="removeRow(this)">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      `;
      return tr;
    }

    document.getElementById("addRowBtn").addEventListener("click", () => {
      daftarHadirBody.appendChild(createRow());
    });

    document.getElementById("absensiForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!agendaRapat.value) {
        alert("Silakan pilih agenda rapat.");
        agendaRapat.focus();
        return;
      }
      if (!pimpinanRapat.value) {
        alert("Pimpinan rapat belum terisi.");
        agendaRapat.focus();
        return;
      }
      if (!sekretarisRapat.value) {
        alert("Sekretaris rapat belum terisi.");
        agendaRapat.focus();
        return;
      }
      if (!tanggalRapat.value) {
        alert("Tanggal rapat belum terisi.");
        agendaRapat.focus();
        return;
      }
      if (!waktuRapat.value) {
        alert("Waktu rapat belum terisi.");
        agendaRapat.focus();
        return;
      }
      if (!tempatRapat.value) {
        alert("Tempat rapat belum terisi.");
        agendaRapat.focus();
        return;
      }

      const rows = daftarHadirBody.querySelectorAll("tr");
      if (rows.length === 0) {
        alert("Daftar hadir harus memiliki minimal satu peserta.");
        return;
      }
      for (const row of rows) {
        const inputs = row.querySelectorAll("input, select");
        for (const input of inputs) {
          if (!input.checkValidity()) {
            input.reportValidity();
            input.focus();
            return;
          }
        }
      }

      const compressedPhotos = await validateAndCompressPhotos();
      if (!compressedPhotos) return;

      const hasilRapat = document.getElementById("hasilRapat");
      if (!hasilRapat.value.trim()) {
        alert("Hasil rapat harus diisi.");
        hasilRapat.focus();
        return;
      }
      const beritaAcara = document.getElementById("beritaAcara");
      if (!beritaAcara.value.trim()) {
        alert("Berita acara harus diisi.");
        beritaAcara.focus();
        return;
      }

      const formData = new FormData();
      formData.append("agendaRapat", agendaRapat.value);
      formData.append("pimpinanRapat", pimpinanRapat.value);
      formData.append("sekretarisRapat", sekretarisRapat.value);
      formData.append("tanggalRapat", tanggalRapat.value);
      formData.append("waktuRapat", waktuRapat.value);
      formData.append("tempatRapat", tempatRapat.value);

      const daftarHadir = Array.from(rows).map(row => ({
        nama: row.querySelector('input[name="nama[]"]').value.trim(),
        jabatanInstansi: row.querySelector('input[name="jabatanInstansi[]"]').value.trim(),
        jabatanRapat: row.querySelector('select[name="jabatanRapat[]"]').value,
        nomorHp: row.querySelector('input[name="nomorHp[]"]').value.trim(),
        statusKehadiran: row.querySelector('select[name="statusKehadiran[]"]').value,
      }));
      formData.append("daftarHadir", JSON.stringify(daftarHadir));

      compressedPhotos.forEach((blob, i) => formData.append(`fotoDokumentasi_${i + 1}`, blob, `fotoDokumentasi_${i + 1}.jpg`));
      formData.append("hasilRapat", hasilRapat.value.trim());
      formData.append("beritaAcara", beritaAcara.value.trim());

      alert("Absensi rapat berhasil dikirim!");
      e.target.reset();
      pimpinanRapat.value = "";
      sekretarisRapat.value = "";
      tanggalRapat.value = "";
      waktuRapat.value = "";
      tempatRapat.value = "";
      daftarHadirBody.innerHTML = "";
      daftarHadirBody.appendChild(createRow());
    });

    // Initialize with one empty row if empty
    if (daftarHadirBody.rows.length === 0) {
      daftarHadirBody.appendChild(createRow());
    }
  </script>
</body>
</html>