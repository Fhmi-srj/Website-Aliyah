<html lang="id" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Halaman Absensi Kegiatan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      @media (max-width: 640px) {
        main {
          font-size: 0.8rem;
        }
        main h1 {
          font-size: 2.4rem;
        }
        form > div,
        form > div > label,
        form > div > h2 {
          margin-bottom: 0.64rem;
        }
        select,
        input[type="text"],
        textarea,
        button,
        input[type="file"] {
          padding: 0.64rem;
          font-size: 0.8rem;
        }
        button {
          padding-left: 1.92rem;
          padding-right: 1.92rem;
          padding-top: 2.4rem;
          padding-bottom: 2.4rem;
        }
        table th,
        table td {
          padding: 0.64rem 0.96rem;
          font-size: 0.8rem;
        }
        #fotoDokumentasiInfo,
        #fotoDokumentasiError {
          font-size: 0.64rem;
        }
        .flex-col-sm {
          flex-direction: column !important;
        }
        .w-full-sm {
          width: 100% !important;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen flex flex-col items-center p-4">
    <main class="w-full max-w-5xl bg-white rounded-lg shadow-md p-6 mb-10">
      <h1 class="text-3xl font-semibold mb-6 text-center text-gray-800">
        Absensi Kegiatan
      </h1>
      <form id="absensiForm" class="space-y-8" novalidate>
        <div class="flex flex-wrap gap-6">
          <div class="flex-1 min-w-[250px]">
            <label for="kegiatan" class="block mb-2 font-medium text-gray-700"
              >Pilih Kegiatan</label
            >
            <select
              id="kegiatan"
              name="kegiatan"
              required
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="" disabled selected>-- Pilih Kegiatan --</option>
              <option value="kegiatan1">Kegiatan Pengembangan Kurikulum</option>
              <option value="kegiatan2">Kegiatan Ekstrakurikuler</option>
              <option value="kegiatan3">Kegiatan Rapat Guru</option>
              <option value="kegiatan4">Kegiatan Workshop</option>
              <option value="kegiatan5">Kegiatan Kunjungan Sekolah</option>
            </select>
          </div>
          <div class="flex-1 min-w-[250px]">
            <label for="guruPJ" class="block mb-2 font-medium text-gray-700"
              >Guru Penanggung Jawab</label
            >
            <select
              id="guruPJ"
              name="guruPJ"
              required
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="" disabled selected>-- Pilih Guru Penanggung Jawab --</option>
              <option value="guru1">Budi Santoso</option>
              <option value="guru2">Siti Aminah</option>
              <option value="guru3">Agus Wijaya</option>
              <option value="guru4">Dewi Lestari</option>
              <option value="guru5">Rina Marlina</option>
            </select>
          </div>
        </div>
        <div class="flex flex-wrap gap-6">
          <div class="flex-1 min-w-[250px] relative" id="guruPendampingWrapper">
            <label class="block mb-2 font-medium text-gray-700"
              >Pilih Guru Pendamping</label
            >
            <button
              type="button"
              id="guruPendampingBtn"
              aria-haspopup="listbox"
              aria-expanded="false"
              class="w-full border border-gray-300 rounded-md p-2 text-left focus:outline-none focus:ring-2 focus:ring-blue-500 flex justify-between items-center"
            >
              <span id="guruPendampingSelected" class="text-gray-600"
                >-- Pilih Guru Pendamping --</span
              >
              <i class="fas fa-chevron-down text-gray-500"></i>
            </button>
            <ul
              id="guruPendampingList"
              tabindex="-1"
              role="listbox"
              aria-multiselectable="true"
              class="absolute z-20 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto hidden"
              style="max-height: 15rem"
            >
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru1"
                  name="guruPendamping[]"
                  value="guru1"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru1" class="select-none cursor-pointer text-gray-700"
                  >Budi Santoso</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru2"
                  name="guruPendamping[]"
                  value="guru2"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru2" class="select-none cursor-pointer text-gray-700"
                  >Siti Aminah</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru3"
                  name="guruPendamping[]"
                  value="guru3"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru3" class="select-none cursor-pointer text-gray-700"
                  >Agus Wijaya</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru4"
                  name="guruPendamping[]"
                  value="guru4"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru4" class="select-none cursor-pointer text-gray-700"
                  >Dewi Lestari</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru5"
                  name="guruPendamping[]"
                  value="guru5"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru5" class="select-none cursor-pointer text-gray-700"
                  >Rina Marlina</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru6"
                  name="guruPendamping[]"
                  value="guru6"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru6" class="select-none cursor-pointer text-gray-700"
                  >Joko Prasetyo</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru7"
                  name="guruPendamping[]"
                  value="guru7"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru7" class="select-none cursor-pointer text-gray-700"
                  >Maya Sari</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru8"
                  name="guruPendamping[]"
                  value="guru8"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru8" class="select-none cursor-pointer text-gray-700"
                  >Hendra Saputra</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru9"
                  name="guruPendamping[]"
                  value="guru9"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru9" class="select-none cursor-pointer text-gray-700"
                  >Lina Marlina</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="pendamping_guru10"
                  name="guruPendamping[]"
                  value="guru10"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="pendamping_guru10" class="select-none cursor-pointer text-gray-700"
                  >Fajar Nugroho</label
                >
              </li>
            </ul>
          </div>
          <div class="flex-1 min-w-[250px] relative" id="sasaranKegiatanWrapper">
            <label class="block mb-2 font-medium text-gray-700"
              >Sasaran Kegiatan</label
            >
            <button
              type="button"
              id="sasaranKegiatanBtn"
              aria-haspopup="listbox"
              aria-expanded="false"
              class="w-full border border-gray-300 rounded-md p-2 text-left focus:outline-none focus:ring-2 focus:ring-blue-500 flex justify-between items-center"
            >
              <span id="sasaranKegiatanSelected" class="text-gray-600"
                >-- Pilih Sasaran Kegiatan --</span
              >
              <i class="fas fa-chevron-down text-gray-500"></i>
            </button>
            <ul
              id="sasaranKegiatanList"
              tabindex="-1"
              role="listbox"
              aria-multiselectable="true"
              class="absolute z-20 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto hidden"
              style="max-height: 15rem"
            >
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="sasaran_guru"
                  name="sasaranKegiatan[]"
                  value="Guru"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="sasaran_guru" class="select-none cursor-pointer text-gray-700"
                  >Guru</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="sasaran_kelasX"
                  name="sasaranKegiatan[]"
                  value="Kelas X"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="sasaran_kelasX" class="select-none cursor-pointer text-gray-700"
                  >Kelas X</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="sasaran_kelasXI"
                  name="sasaranKegiatan[]"
                  value="Kelas XI"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="sasaran_kelasXI" class="select-none cursor-pointer text-gray-700"
                  >Kelas XI</label
                >
              </li>
              <li class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer">
                <input
                  type="checkbox"
                  id="sasaran_kelasXII"
                  name="sasaranKegiatan[]"
                  value="Kelas XII"
                  class="mr-2 focus:ring-blue-500"
                />
                <label for="sasaran_kelasXII" class="select-none cursor-pointer text-gray-700"
                  >Kelas XII</label
                >
              </li>
            </ul>
          </div>
        </div>
        <div>
          <label for="fotoDokumentasi" class="block mb-2 font-medium text-gray-700"
            >Dokumentasi Foto (minimal 2 foto)</label
          >
          <input
            type="file"
            accept="image/*"
            id="fotoDokumentasi"
            name="fotoDokumentasi"
            multiple
            required
            class="block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
          />
          <p id="fotoDokumentasiInfo" class="text-sm text-gray-500 mt-2">
            Unggah minimal 2 foto. Foto akan otomatis dikompres agar ukuran
            antara 100-300kb.
          </p>
          <p id="fotoDokumentasiError" class="text-xs text-red-600 mt-1 hidden">
            Harap unggah minimal 2 foto.
          </p>
        </div>
        <div id="daftarHadirGuruContainer">
          <h2 class="text-xl font-semibold mb-3 text-gray-800">Daftar Hadir Guru</h2>
          <div class="overflow-x-auto border border-gray-300 rounded-md mb-8">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">No</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Nama Guru</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Jabatan</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Status</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Keterangan</th>
                </tr>
              </thead>
              <tbody id="guruList" class="divide-y divide-gray-200">
                <tr data-guru="guru1">
                  <td class="px-3 py-2">1</td>
                  <td class="px-3 py-2">Budi Santoso</td>
                  <td class="px-3 py-2">Kepala Sekolah</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_guru_1"
                        data-index="guru1"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Budi Santoso"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_guru1"
                      data-index="guru1"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-guru="guru2">
                  <td class="px-3 py-2">2</td>
                  <td class="px-3 py-2">Siti Aminah</td>
                  <td class="px-3 py-2">Wakil Kepala Sekolah</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_guru_2"
                        data-index="guru2"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Siti Aminah"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_guru2"
                      data-index="guru2"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-guru="guru3">
                  <td class="px-3 py-2">3</td>
                  <td class="px-3 py-2">Agus Wijaya</td>
                  <td class="px-3 py-2">Guru Matematika</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_guru_3"
                        data-index="guru3"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Agus Wijaya"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_guru3"
                      data-index="guru3"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-guru="guru4">
                  <td class="px-3 py-2">4</td>
                  <td class="px-3 py-2">Dewi Lestari</td>
                  <td class="px-3 py-2">Guru Bahasa Indonesia</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_guru_4"
                        data-index="guru4"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Dewi Lestari"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_guru4"
                      data-index="guru4"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-guru="guru5">
                  <td class="px-3 py-2">5</td>
                  <td class="px-3 py-2">Rina Marlina</td>
                  <td class="px-3 py-2">Guru IPA</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_guru_5"
                        data-index="guru5"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Rina Marlina"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_guru5"
                      data-index="guru5"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div id="daftarSiswaContainer">
          <h2 class="text-xl font-semibold mb-3 text-gray-800">Daftar Siswa</h2>
          <div class="overflow-x-auto border border-gray-300 rounded-md mb-8">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">No</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Nama Siswa</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Kelas</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Status</th>
                  <th class="px-3 py-2 text-left font-medium text-gray-700">Keterangan</th>
                </tr>
              </thead>
              <tbody id="siswaList" class="divide-y divide-gray-200">
                <tr data-kelas="Kelas X">
                  <td class="px-3 py-2">1</td>
                  <td class="px-3 py-2">Ahmad Fauzi</td>
                  <td class="px-3 py-2">Kelas X</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_1"
                        data-index="1"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Ahmad Fauzi"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_1"
                      data-index="1"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas XI">
                  <td class="px-3 py-2">2</td>
                  <td class="px-3 py-2">Sari Melati</td>
                  <td class="px-3 py-2">Kelas XI</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_2"
                        data-index="2"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Sari Melati"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_2"
                      data-index="2"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas XII">
                  <td class="px-3 py-2">3</td>
                  <td class="px-3 py-2">Dewi Kartika</td>
                  <td class="px-3 py-2">Kelas XII</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_3"
                        data-index="3"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Dewi Kartika"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_3"
                      data-index="3"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas X">
                  <td class="px-3 py-2">4</td>
                  <td class="px-3 py-2">Rizky Pratama</td>
                  <td class="px-3 py-2">Kelas X</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_4"
                        data-index="4"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Rizky Pratama"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_4"
                      data-index="4"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas XI">
                  <td class="px-3 py-2">5</td>
                  <td class="px-3 py-2">Nina Larasati</td>
                  <td class="px-3 py-2">Kelas XI</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_5"
                        data-index="5"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Nina Larasati"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_5"
                      data-index="5"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas XII">
                  <td class="px-3 py-2">6</td>
                  <td class="px-3 py-2">Fajar Nugroho</td>
                  <td class="px-3 py-2">Kelas XII</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_6"
                        data-index="6"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Fajar Nugroho"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_6"
                      data-index="6"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas X">
                  <td class="px-3 py-2">7</td>
                  <td class="px-3 py-2">Lina Marlina</td>
                  <td class="px-3 py-2">Kelas X</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_7"
                        data-index="7"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Lina Marlina"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_7"
                      data-index="7"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas XI">
                  <td class="px-3 py-2">8</td>
                  <td class="px-3 py-2">Rina Marlina</td>
                  <td class="px-3 py-2">Kelas XI</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_8"
                        data-index="8"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Rina Marlina"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_8"
                      data-index="8"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas XII">
                  <td class="px-3 py-2">9</td>
                  <td class="px-3 py-2">Joko Prasetyo</td>
                  <td class="px-3 py-2">Kelas XII</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_9"
                        data-index="9"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Joko Prasetyo"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_9"
                      data-index="9"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
                <tr data-kelas="Kelas X">
                  <td class="px-3 py-2">10</td>
                  <td class="px-3 py-2">Maya Sari</td>
                  <td class="px-3 py-2">Kelas X</td>
                  <td class="px-3 py-2">
                    <div class="relative inline-block w-full">
                      <select
                        name="status_10"
                        data-index="10"
                        class="status-select w-full border border-gray-300 rounded-md p-1 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                        aria-label="Status Maya Sari"
                      >
                        <option value="Hadir" selected>Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alpha">Alpha</option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700"
                      >
                        <i class="fas fa-check-circle text-green-600 status-icon"></i>
                      </div>
                    </div>
                  </td>
                  <td class="px-3 py-2">
                    <input
                      type="text"
                      name="keterangan_10"
                      data-index="10"
                      class="keterangan-input w-full border border-gray-300 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled
                      placeholder="Keterangan jika Izin/Sakit"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div>
          <label for="beritaAcara" class="block mb-2 font-medium text-gray-700"
            >Berita Acara</label
          >
          <textarea
            id="beritaAcara"
            name="beritaAcara"
            rows="5"
            placeholder="Tuliskan berita acara kegiatan di sini..."
            class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y"
            required
          ></textarea>
        </div>
        <div class="text-center">
          <button
            type="submit"
            class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-md focus:outline-none focus:ring-4 focus:ring-blue-300"
          >
            <i class="fas fa-check-circle"></i> Kirim Absensi
          </button>
        </div>
      </form>
    </main>
    <script>
      const guruPendampingBtn = document.getElementById("guruPendampingBtn");
      const guruPendampingList = document.getElementById("guruPendampingList");
      const guruPendampingSelected = document.getElementById("guruPendampingSelected");
      const guruPendampingWrapper = document.getElementById("guruPendampingWrapper");
      const pendampingCheckboxes = guruPendampingList.querySelectorAll(
        'input[type="checkbox"]'
      );

      guruPendampingBtn.addEventListener("click", () => {
        const expanded = guruPendampingBtn.getAttribute("aria-expanded") === "true";
        guruPendampingList.classList.toggle("hidden", expanded);
        guruPendampingBtn.setAttribute("aria-expanded", !expanded);
      });

      document.addEventListener("click", (e) => {
        if (!guruPendampingWrapper.contains(e.target)) {
          guruPendampingList.classList.add("hidden");
          guruPendampingBtn.setAttribute("aria-expanded", "false");
        }
      });

      function updateSelectedPendampingText() {
        const checked = Array.from(pendampingCheckboxes).filter((chk) => chk.checked);
        guruPendampingSelected.textContent =
          checked.length === 0
            ? "-- Pilih Guru Pendamping --"
            : checked.map((chk) => chk.nextElementSibling.textContent).join(", ");
      }
      pendampingCheckboxes.forEach((chk) => chk.addEventListener("change", updateSelectedPendampingText));

      // Sasaran Kegiatan dropdown
      const sasaranKegiatanBtn = document.getElementById("sasaranKegiatanBtn");
      const sasaranKegiatanList = document.getElementById("sasaranKegiatanList");
      const sasaranKegiatanSelected = document.getElementById("sasaranKegiatanSelected");
      const sasaranKegiatanWrapper = document.getElementById("sasaranKegiatanWrapper");
      const sasaranCheckboxes = sasaranKegiatanList.querySelectorAll('input[type="checkbox"]');

      sasaranKegiatanBtn.addEventListener("click", () => {
        const expanded = sasaranKegiatanBtn.getAttribute("aria-expanded") === "true";
        sasaranKegiatanList.classList.toggle("hidden", expanded);
        sasaranKegiatanBtn.setAttribute("aria-expanded", !expanded);
      });

      document.addEventListener("click", (e) => {
        if (!sasaranKegiatanWrapper.contains(e.target)) {
          sasaranKegiatanList.classList.add("hidden");
          sasaranKegiatanBtn.setAttribute("aria-expanded", "false");
        }
      });

      function updateSelectedSasaranText() {
        const checked = Array.from(sasaranCheckboxes).filter((chk) => chk.checked);
        sasaranKegiatanSelected.textContent =
          checked.length === 0
            ? "-- Pilih Sasaran Kegiatan --"
            : checked.map((chk) => chk.nextElementSibling.textContent).join(", ");
        updateDaftarHadirGuruVisibility(checked);
        updateDaftarSiswaVisibility(checked);
      }
      sasaranCheckboxes.forEach((chk) => chk.addEventListener("change", updateSelectedSasaranText));

      // Show/hide Daftar Hadir Guru based on "Guru" checkbox
      const daftarHadirGuruContainer = document.getElementById("daftarHadirGuruContainer");
      const guruRows = document.querySelectorAll("#guruList tr[data-guru]");

      function updateDaftarHadirGuruVisibility(checkedSasaran) {
        const guruSelected = checkedSasaran.some((chk) => chk.value === "Guru");
        if (guruSelected) {
          daftarHadirGuruContainer.style.display = "";
          guruRows.forEach((row) => {
            row.style.display = "";
          });
        } else {
          daftarHadirGuruContainer.style.display = "none";
          guruRows.forEach((row) => {
            row.style.display = "none";
          });
        }
      }

      // Show/hide Daftar Siswa rows based on selected kelas
      const daftarSiswaContainer = document.getElementById("daftarSiswaContainer");
      const siswaRows = document.querySelectorAll("#siswaList tr[data-kelas]");

      function updateDaftarSiswaVisibility(checkedSasaran) {
        // Get selected kelas values
        const selectedKelas = checkedSasaran
          .filter((chk) => chk.value !== "Guru")
          .map((chk) => chk.value);
        if (selectedKelas.length === 0) {
          // Hide entire siswa container if no kelas selected
          daftarSiswaContainer.style.display = "none";
          siswaRows.forEach((row) => {
            row.style.display = "none";
          });
        } else {
          daftarSiswaContainer.style.display = "";
          siswaRows.forEach((row) => {
            if (selectedKelas.includes(row.getAttribute("data-kelas"))) {
              row.style.display = "";
            } else {
              row.style.display = "none";
            }
          });
        }
      }

      // Initialize visibility on page load
      updateSelectedSasaranText();

      const statusIconClasses = {
        Hadir: "fas fa-check-circle text-green-600",
        Izin: "fas fa-calendar-alt text-blue-600",
        Sakit: "fas fa-ambulance text-red-600",
        Alpha: "fas fa-exclamation-triangle text-amber-600",
      };

      function updateStatusIcon(select) {
        const iconDiv = select.parentElement.querySelector(".status-icon");
        const val = select.value;
        iconDiv.className = "fas status-icon " + (statusIconClasses[val] || "");
      }

      document.querySelectorAll(".status-select").forEach((select) => {
        updateStatusIcon(select);
        select.addEventListener("change", (e) => {
          const index = e.target.dataset.index;
          let keteranganInput;
          if (index.startsWith("guru")) {
            keteranganInput = document.querySelector(`input[name="keterangan_${index}"]`);
          } else {
            keteranganInput = document.querySelector(`input[name="keterangan_${index}"]`);
          }
          if (e.target.value === "Izin" || e.target.value === "Sakit") {
            keteranganInput.disabled = false;
            keteranganInput.required = true;
            keteranganInput.focus();
          } else {
            keteranganInput.disabled = true;
            keteranganInput.required = false;
            keteranganInput.value = "";
          }
          updateStatusIcon(e.target);
        });
      });

      async function compressImage(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = (event) => {
            const img = new Image();
            img.src = event.target.result;
            img.onload = () => {
              const canvas = document.createElement("canvas");
              const maxWidth = 1024;
              const maxHeight = 1024;
              let width = img.width;
              let height = img.height;
              if (width > height) {
                if (width > maxWidth) {
                  height *= maxWidth / width;
                  width = maxWidth;
                }
              } else {
                if (height > maxHeight) {
                  width *= maxHeight / height;
                  height = maxHeight;
                }
              }
              canvas.width = width;
              canvas.height = height;
              const ctx = canvas.getContext("2d");
              ctx.clearRect(0, 0, width, height);
              ctx.drawImage(img, 0, 0, width, height);
              let quality = 0.9;
              function tryCompress() {
                canvas.toBlob(
                  (blob) => {
                    if (!blob) {
                      reject(new Error("Compression failed"));
                      return;
                    }
                    if (blob.size >= 100 * 1024 && blob.size <= 300 * 1024) {
                      resolve(blob);
                    } else if (quality > 0.4) {
                      quality -= 0.1;
                      tryCompress();
                    } else {
                      resolve(blob);
                    }
                  },
                  "image/jpeg",
                  quality
                );
              }
              tryCompress();
            };
            img.onerror = () => reject(new Error("Invalid image"));
          };
          reader.onerror = () => reject(new Error("File reading error"));
        });
      }

      async function validateAndCompressPhotos() {
        const fotoInput = document.getElementById("fotoDokumentasi");
        const fotoError = document.getElementById("fotoDokumentasiError");
        fotoError.classList.add("hidden");
        if (!fotoInput.files || fotoInput.files.length < 2) {
          fotoError.textContent = "Harap unggah minimal 2 foto.";
          fotoError.classList.remove("hidden");
          return null;
        }
        try {
          const compressedPhotos = [];
          for (let i = 0; i < fotoInput.files.length; i++) {
            compressedPhotos.push(await compressImage(fotoInput.files[i]));
          }
          return compressedPhotos;
        } catch (error) {
          alert("Terjadi kesalahan saat memproses foto: " + error.message);
          return null;
        }
      }

      document.getElementById("absensiForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const kegiatan = document.getElementById("kegiatan");
        const guruPJ = document.getElementById("guruPJ");
        if (!kegiatan.value) {
          alert("Silakan pilih kegiatan.");
          kegiatan.focus();
          return;
        }
        if (!guruPJ.value) {
          alert("Silakan pilih guru penanggung jawab.");
          guruPJ.focus();
          return;
        }
        const checkedPendamping = Array.from(pendampingCheckboxes).filter((chk) => chk.checked);
        if (checkedPendamping.length === 0) {
          alert("Silakan pilih minimal satu guru pendamping.");
          guruPendampingBtn.focus();
          return;
        }
        const checkedSasaran = Array.from(sasaranCheckboxes).filter((chk) => chk.checked);
        if (checkedSasaran.length === 0) {
          alert("Silakan pilih minimal satu sasaran kegiatan.");
          sasaranKegiatanBtn.focus();
          return;
        }
        const compressedPhotos = await validateAndCompressPhotos();
        if (!compressedPhotos) return;

        // Validate keterangan for guru only if guru is selected
        const guruSelected = checkedSasaran.some((chk) => chk.value === "Guru");
        if (guruSelected) {
          for (const select of document.querySelectorAll(".status-select")) {
            const index = select.dataset.index;
            if (!index.startsWith("guru")) continue; // skip siswa
            const keteranganInput = document.querySelector(`input[name="keterangan_${index}"]`);
            if ((select.value === "Izin" || select.value === "Sakit") && !keteranganInput.value.trim()) {
              alert(`Keterangan harus diisi untuk status Izin atau Sakit pada guru nomor ${index.replace("guru", "")}`);
              keteranganInput.focus();
              return;
            }
          }
        }

        // Validate keterangan for siswa only for visible siswa rows
        const selectedKelas = checkedSasaran
          .filter((chk) => chk.value !== "Guru")
          .map((chk) => chk.value);
        for (const select of document.querySelectorAll(".status-select")) {
          const index = select.dataset.index;
          if (index.startsWith("guru")) continue; // skip guru
          const keteranganInput = document.querySelector(`input[name="keterangan_${index}"]`);
          if (!keteranganInput) continue;
          const tr = keteranganInput.closest("tr");
          if (tr && tr.style.display === "none") continue; // skip hidden rows
          if ((select.value === "Izin" || select.value === "Sakit") && !keteranganInput.value.trim()) {
            alert(`Keterangan harus diisi untuk status Izin atau Sakit pada siswa nomor ${index}`);
            keteranganInput.focus();
            return;
          }
        }

        const beritaAcara = document.getElementById("beritaAcara");
        if (!beritaAcara.value.trim()) {
          alert("Berita acara harus diisi.");
          beritaAcara.focus();
          return;
        }
        const formData = new FormData();
        formData.append("kegiatan", kegiatan.value);
        formData.append("guruPJ", guruPJ.value);
        checkedPendamping.forEach((chk) => formData.append("guruPendamping[]", chk.value));
        checkedSasaran.forEach((chk) => formData.append("sasaranKegiatan[]", chk.value));
        compressedPhotos.forEach((blob, i) =>
          formData.append(`fotoDokumentasi_${i + 1}`, blob, `fotoDokumentasi_${i + 1}.jpg`)
        );

        // Append guru status and keterangan only if guru is selected
        if (guruSelected) {
          document.querySelectorAll(".status-select").forEach((select) => {
            const index = select.dataset.index;
            if (!index.startsWith("guru")) return;
            formData.append(`status_${index}`, select.value);
            const keteranganInput = document.querySelector(`input[name="keterangan_${index}"]`);
            formData.append(`keterangan_${index}`, keteranganInput.value.trim());
          });
        }

        // Append siswa status and keterangan only for selected kelas
        const selectedKelasSet = new Set(selectedKelas);
        document.querySelectorAll(".status-select").forEach((select) => {
          const index = select.dataset.index;
          if (index.startsWith("guru")) return;
          const keteranganInput = document.querySelector(`input[name="keterangan_${index}"]`);
          if (!keteranganInput) return;
          const tr = keteranganInput.closest("tr");
          if (!tr) return;
          const kelas = tr.getAttribute("data-kelas");
          if (!selectedKelasSet.has(kelas)) return;
          formData.append(`status_${index}`, select.value);
          formData.append(`keterangan_${index}`, keteranganInput.value.trim());
        });

        formData.append("beritaAcara", beritaAcara.value.trim());
        alert("Absensi kegiatan berhasil dikirim!");
        e.target.reset();
        guruPendampingSelected.textContent = "-- Pilih Guru Pendamping --";
        pendampingCheckboxes.forEach((chk) => (chk.checked = false));
        sasaranKegiatanSelected.textContent = "-- Pilih Sasaran Kegiatan --";
        sasaranCheckboxes.forEach((chk) => (chk.checked = false));
        document.querySelectorAll(".keterangan-input").forEach((input) => (input.disabled = true));
        document.querySelectorAll(".status-select").forEach((select) => {
          select.value = "Hadir";
          updateStatusIcon(select);
        });
        updateSelectedSasaranText();
      });
    </script>
  </body>
</html>